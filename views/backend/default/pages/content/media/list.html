@extends('default', ['bodyClass' => 'gallery-page'])

@section('title') {{{ $caption }}} :: @parent @stop

@section('content')
@include('topbar')
<section id="content" class="table-layout">
  <div class="tray tray-center pn va-t">
    <div class="mh15 pv15 br-b br-light">
      <div class="row">
        <div class="col-xs-7">
          <div class="mix-controls ib">
            <form id="select-filters" class="controls">
              <div class="btn-group ib mr10">
                <button type="button" class="btn btn-default hidden-xs">
                  <span class="fa fa-tag"></span>
                </button>
                <div class="btn-group">
                  <fieldset>
                    <select id="filter2">
                      <option value="">@lang('admin.label.labels', 'Etiketler')</option>
                      <!--<option value=".label1">Work</option>
                      <option value=".label3">Clients</option>
                      <option value=".label2">Family</option>-->
                    </select>
                  </fieldset>
                </div>
              </div>
            </form>
          </div>
        </div>
        <div class="col-xs-5 text-right">
          <div class="btn-group">
            <button type="button" class="btn btn-default to-grid">
              <span class="fa fa-th"></span>
            </button>
            <button type="button" class="btn btn-default to-list">
              <span class="fa fa-navicon"></span>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div id="mix-container"></div>
  </div>
  <aside class="tray tray-right tray250 va-t pn" data-tray-height="match">
    <form id="filter-form" class="p15 admin-form" method="post" action="@url()">
      <h4 class="mt5 text-muted fw500">@lang('admin.label.filters', 'Filtreler')</h4>
      <hr class="short">
      <div class="section mb15">
        <label class="field prepend-icon">
          <input type="text" id="filter-id" name="filter-id" class="gui-input" placeholder="# ID">
          <span class="field-icon">
      <i class="fa fa-info"></i>
     </span>
        </label>
      </div>
      <h6 class="fw400">@lang('admin.label.media_role', 'Türü')</h6>
      <div class="section">
        <label class="field select">
          <select id="filter-meta-role" name="filter-meta-role">
            <option value="">@lang('admin.label.all', 'Tümü')</option>
            <option value="image">@lang('admin.label.image', 'Resim')</option>
            <option value="file">@lang('admin.label.file', 'Dosya')</option>
            <option value="video">@lang('admin.label.video', 'Görüntü')</option>
            <option value="audio">@lang('admin.label.audio', 'Ses')</option>
            <option value="link">@lang('admin.label.link', 'Bağlantı')</option>
          </select>
          <i class="arrow double"></i>
        </label>
      </div>
      <h6 class="fw400">@lang('admin.label.content.publish_date', 'Yayın Tarihi')</h6>
      <div class="section row">
        <div class="col-md-6">
          <label class="field">
            <input type="text" id="filter-publish_date-start" name="filter-publish_date-start" class="gui-input" placeholder="{{{ now('short') }}}">
          </label>
        </div>
        <div class="col-md-6">
          <label class="field">
            <input type="text" id="filter-publish_date-end" name="filter-publish_date-end" class="gui-input" placeholder="{{{ now('short') }}}">
          </label>
        </div>
      </div>
      <h6 class="fw400">@lang('admin.label.content.title', 'Başlık')</h6>
      <div class="section mb15">
        <label class="field prepend-icon">
          <input type="text" id="filter-title" name="filter-title" class="gui-input">
          <span class="field-icon">
      <i class="fa fa-pencil"></i>
     </span>
        </label>
      </div>
      <hr class="short">
      <div class="section row">
        <div class="col-sm-12">
          <button type="submit" class="btn btn-default btn-sm ph25">
            @lang('admin.button.filter', 'Filtrele')
          </button>
        </div>
      </div>
    </form>
  </aside>
</section>

<div id="audio-modal" class="popup-block black mfp-hide"></div>
<div id="video-modal" class="popup-block black mfp-hide"></div>

<div id="edit-dialog" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">×</button>
        <h4>
          <i class="fa fa-edit"></i>
          @lang('admin.label.edit', 'Düzenle')
        </h4>
      </div>
      <form id="edit-form" method="post" action="@url($prefix . 'content/media/save')">
        <input type="hidden" id="id" name="id" class="form-control" value="0">
        <div class="modal-body">
          <div class="form-group">
            <label for="title">@lang('admin.label.title', 'Başlık')</label>
            <input type="text" id="title" name="title" class="form-control">
          </div>
          <div class="form-group">
            <label for="description">@lang('admin.label.description', 'Açıklama')</label>
            <textarea id="description" name="description" rows="4" class="form-control"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-sm btn-success">
            <i class="fa fa-save"></i>
            @lang('admin.button.save', 'Kaydet')
          </button>
          <button type="button" class="btn btn-sm btn-danger" data-dismiss="modal">
            <i class="fa fa-close"></i>
            @lang('admin.button.close', 'Kapat')
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<div id="upload-dialog" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">×</button>
        <h4>
          <i class="fa fa-picture-o"></i>
          @lang('admin.label.upload_media', 'Medya Yükle')
        </h4>
      </div>
      <div class="modal-body">
        <form id="upload-form" method="post" action="@url($prefix . 'content/media/upload')">
          <input type="file" id="file" name="media-file[]" class="file-loading" multiple>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-sm btn-danger" data-dismiss="modal">
          <i class="fa fa-close"></i>
          @lang('admin.button.close', 'Kapat')
        </button>
      </div>
    </div>
  </div>
</div>

<div id="link-dialog" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">×</button>
        <h4>
          <i class="fa fa-link"></i>
          @lang('admin.label.add_link', 'Bağlantı Ekle')
        </h4>
      </div>
      <div class="modal-body">
        <form id="link-info-form" method="post" action="@url($prefix . 'content/media/link')">
          <div class="input-group">
            <input type="text" id="link-raw-url" name="link-raw-url" class="form-control" placeholder="@lang('admin.hint.paste_url_here', 'Bağlantıyı buraya yapıştırın')">
            <span class="input-group-btn">
       <button type="submit" class="btn btn-sm btn-info">
        <i class="fa fa-crosshairs fa-2x"></i>
       </button>
      </span>
          </div>
        </form>
        <hr class="divider short">
        <form id="link-form" method="post" action="@url($prefix . 'content/media/link')">
          <input type="hidden" id="link-url" name="link-url">
          <input type="hidden" id="link-embed-url" name="link-embed-url">
          <div class="row">
            <div class="col-xs-12 col-md-5">
              <div class="image-selector">
                <input type="hidden" id="link-poster" name="link-poster">
                <div id="link-poster-view"></div>
                <nav id="link-poster-nav">
                  <a class="prev" href="javascript:void(0)">
                    <i class="fa fa-angle-left"></i>
                  </a>
                  <a class="next" href="javascript:void(0)">
                    <i class="fa fa-angle-right"></i>
                  </a>
                </nav>
              </div>
            </div>
            <div class="col-xs-12 col-md-7">
              <div class="form-group">
                <label for="link-title">@lang('admin.label.title', 'Başlık')</label>
                <input type="text" id="link-title" name="link-title" class="form-control">
              </div>
              <div class="form-group">
                <label for="link-description">@lang('admin.label.description', 'Açıklama')</label>
                <textarea id="link-description" name="link-description" rows="4" class="form-control"></textarea>
              </div>
              <div class="form-group">
                <div class="checkbox-custom fill checkbox-default">
                  <input type="checkbox" id="link-no-thumbnail" name="link-no-thumbnail" value="yes">
                  <label for="link-no-thumbnail">@lang('admin.label.no_thumbnail_image', 'Küçük Resim Yok')</label>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" id="add-link" class="btn btn-sm btn-info">
          <i class="fa fa-plus"></i>
          @lang('admin.button.add', 'Ekle')
        </button>
        <button type="button" class="btn btn-sm btn-danger" data-dismiss="modal">
          <i class="fa fa-close"></i>
          @lang('admin.button.close', 'Kapat')
        </button>
      </div>
    </div>
  </div>
</div>
@stop

@section('link')
@parent
<link rel="stylesheet" type="text/css" href="{{ $root }}/js/plugins/jquery/magnific/magnific-popup.css">
<link rel="stylesheet" type="text/css" href="{{ $root }}/js/plugins/fileinput/css/fileinput.min.css">
@stop

@section('script')
@parent
<script type="text/javascript" src="{{ $root }}/js/plugins/jquery/magnific/jquery.magnific-popup.js"></script>
<script type="text/javascript" src="{{ $root }}/js/plugins/jquery/jquery.mixitup.min.js"></script>
<script type="text/javascript" src="{{ $root }}/js/plugins/fileinput/js/fileinput.min.js"></script>
<script type="text/javascript" src="{{ $root }}/js/plugins/fileinput/js/fileinput_locale_{{ lang() }}.js"></script>
<script type="text/javascript" src="{{ $root }}/js/plugins/bootstrap/holder.min.js"></script>
<script type="text/javascript">
  //<![CDATA[
  $(function () {
    'use strict';

    var total = 0, offset = -1, limit = 0, running = false, init = false;
    var $container = $('#mix-container'), // mixitup container
      $toList = $('.to-list'), // list view button
      $toGrid = $('.to-grid'); // list view button

    $('#file').fileinput({
      uploadUrl: $('#upload-form').attr('action'),
      uploadAsync: false,
      maxFileCount: 50,
      overwriteInitial: false
    }).on('filebatchuploadsuccess', function (e, data) {
      for (var k in data.response) {
        $container.prepend(preview(data.response[k]));
      }

      mixer();
      event();
    });

    $('#upload-dialog').on('show.bs.modal', function () {
      $('#upload-dialog .fileinput-remove-button').trigger('click');
      $('#upload-dialog .file-caption-name').empty();
    });

    $('a[href="#upload"]').click(function (e) {
      e.preventDefault();

      $('#upload-dialog').modal();
    });

    $('a[href="#link"]').click(function (e) {
      e.preventDefault();

      $('#link-url, #link-raw-url, #link-embed-url, #link-poster, #link-title, #link-description').val('');
      $('#link-poster-view').data({}).empty();
      $('#link-poster-nav > a').css({
        'opacity': .1,
        'cursor': 'default'
      });
      $('#link-no-thumbnail').prop('disabled', true);

      Holder.addImage("holder.js/220x160/text:@lang('admin.label.link_picture', 'Bağlantı Resmi')", '#link-poster-view').run();

      $('#link-dialog').modal();
    });

    $('#add-link').click(function () {
      if ($('#link-url').val().length > 0) {
        $.ajax({
          'type': $('#link-form').attr('method'),
          'url': $('#link-form').attr('action'),
          'data': {
            'link-url': $('#link-url').val(),
            'link-embed-url': $('#link-embed-url').val(),
            'link-poster': $('#link-poster').val(),
            'link-title': $('#link-title').val(),
            'link-description': $('#link-description').val()
          }
        }).done(function (result) {
          if (result.success) {
            $('#link-dialog').modal('hide');

            $.ajax({
              'type': 'GET',
              'url': "@url($prefix . 'content/media')",
              'data': 'id=' + result.return.id
            }).done(function (result) {
              if (result['total'] > 0) {
                var r = result['rows'][0];

                $container.prepend(preview(r));

                mixer();
                event();
              } else {
                message("@lang('admin.message.an_error_occured', 'Bir hata oluştu!')");
              }
            });
          } else {
            message(result);
          }
        });
      } else {
        message("@lang('admin.message.paste_link_first', 'Önce bağlantıyı yapıştırın!')");
      }

      return false;
    });

    $('#link-info-form').submit(function () {
      if ($('#link-raw-url').val().length > 0) {
        $.ajax({
          'type': $(this).attr('method'),
          'url': $(this).attr('action'),
          'data': {
            'link-raw-url': $('#link-raw-url').val()
          }
        }).done(function (result) {
          if (result && result['link-url']) {
            var k;

            for (k in result) {
              if ($('#' + k).get(0)) {
                $('#' + k).val(result[k]);
              }
            }

            if (result['link-images'] && result['link-images'].length > 0) {
              $('#link-poster-view').empty();

              $('<img/>', {
                'src': result['link-images'][0],
                'alt': '',
                'width': 220
              }).appendTo('#link-poster-view');

              var imgs = [];

              for (k in result['link-images']) {
                imgs.push(result['link-images'][k]);
              }

              $('#link-poster-view').data({
                'images': imgs.join(','),
                'current': 0
              });

              $('#link-poster').val(imgs[0]);
              $('#link-no-thumbnail').prop('disabled', false);

              if (imgs.length > 1) {
                $('#link-poster-nav > a.next').css({
                  'opacity': 1,
                  'cursor': 'pointer'
                });
              }
            }
          } else {
            message(result);
          }
        });
      } else {
        message("@lang('admin.message.paste_link_first', 'Önce bağlantıyı yapıştırın!')");
      }

      return false;
    });

    $('#link-poster-nav > a').click(function () {
      if (!$('#link-no-thumbnail').prop('checked') && parseFloat($('#link-poster-view').data('current')) > -1) {
        var imgs = $('#link-poster-view').data('images').split(','),
          curr = $('#link-poster-view').data('current'),
          targ = curr;

        if ($(this).hasClass('prev')) {
          targ = curr - 1;
        } else if ($(this).hasClass('next')) {
          targ = curr + 1;
        }

        if (imgs[targ]) {
          $('#link-no-thumbnail').prop('checked', false);
          $('#link-poster').val(imgs[targ]);
          $('#link-poster-view').data('current', targ).find('img').attr('src', imgs[targ]);
          $('#link-poster-nav > a').css({
            'opacity': .1,
            'cursor': 'default'
          });

          if (targ > 0) {
            $('#link-poster-nav > a.prev').css({
              'opacity': 1,
              'cursor': 'pointer'
            });
          }

          if (targ < (imgs.length - 1)) {
            $('#link-poster-nav > a.next').css({
              'opacity': 1,
              'cursor': 'pointer'
            });
          }
        }
      }

      return false;
    });

    $('#link-no-thumbnail').click(function () {
      if (!$(this).prop('disabled')) {
        var imgs = $('#link-poster-view').data('images').split(',');

        if ($(this).prop('checked')) {
          $('#link-poster').val('');
          $('#link-poster-view').empty().data('current', -1);

          Holder.addImage("holder.js/220x160/text:@lang('admin.label.link_picture', 'Bağlantı Resmi')", '#link-poster-view').run();

          $('#link-poster-nav > a').css({
            'opacity': .1,
            'cursor': 'default'
          });
        } else {
          $('#link-poster').val(imgs[0]);
          $('#link-poster-view').empty().data('current', 0);

          $('<img/>', {
            'src': imgs[0],
            'alt': '',
            'width': 220
          }).appendTo('#link-poster-view');

          if (imgs.length > 1) {
            $('#link-poster-nav > a.next').css({
              'opacity': 1,
              'cursor': 'pointer'
            });
          }
        }
      }
    });

    function preview(r) {
      return $('<div/>', {
        'data-id': r.id
      }).addClass('mix ' + r.role).append(
        $('<div/>').addClass('panel p6 pbn').append(
          $('<div/>').addClass('of-h').append(
            $('<img/>', {
              'src': r.thumb
            }).data('info', r).addClass('h-170 center-block'),
            $('<div/>').addClass('row table-layout').append(
              $('<div/>').addClass('col-xs-8 va-m pln').append(
                $('<h6/>').html(r.title.length ? r.title : '&nbsp;')
              ),
              $('<div/>').addClass('col-xs-4 va-m prn text-right').append(
                $('<span/>', {
                  'data-id': r.id,
                  'data-button': 'edit'
                }).addClass('fa fa-edit fs12 text-info'),
                $('<span/>', {
                  'data-id': r.id,
                  'data-button': 'delete'
                }).addClass('fa fa-trash-o fs12 ml10 text-danger'),
                $('<span/>').addClass('fa fa-circle fs12 ml10 text' + (r.active ? 'info' : 'muted'))
              )
            )
          )
        )
      );
    }

    function loadList(strict) {
      if ((((offset + limit) < total) || strict) && !running) {
        running = true;

        var filters = [];

        filters.push('offset=' + (limit && !strict ? offset + limit : 0));

        $('#filter-form').find('input, select').each(function () {
          if (($(this).is('input') && $(this).val().length) || ($(this).is('select') && $(this).val() != '0')) {
            filters.push($(this).attr('name').replace('filter-', '') + '=' + $(this).val());
          }
        });

        $.ajax({
          'type': 'GET',
          'url': '@url()',
          'data': filters.join('&')
        }).done(function (result) {
          if (result && result.rows) {
            if (!limit || strict) {
              $container.empty();
            }

            offset = parseFloat(result.offset);
            limit = parseFloat(result.limit);
            total = parseFloat(result.total);

            for (var k in result.rows) {
              $container.append(preview(result.rows[k]));
            }
          }

          mixer();
          event();

          running = false;
        });
      }
    }

    loadList();

    $(window).scroll(function () {
      var t = 0 + $(document).height() - $container.scrollTop() - $(window).height();
      var c = $(window).scrollTop();

      if (c + 50 > t) {
        loadList();
      }
    });

    $('#edit-form').submit(function (e) {
      e.preventDefault();

      $.ajax({
        'type': $(this).attr('method'),
        'url': $(this).attr('action') + '/' + $('#id').val(),
        'data': $(this).serialize()
      }).done(function (result) {
        if (result.success) {
          var title = $('#title').val();
          $('.mix[data-id="' + $('#id').val() + '"]').find('h6').text(title.length ? title : '&nbsp;');
          $('#edit-dialog').modal('hide');
        }

        new PNotify({
          title: "@lang('message.result', 'İşlem Sonucu')",
          text: result.text,
          type: result.success ? 'success' : 'error',
          buttons: {
            closer: true,
            sticker: false
          },
          history: {
            history: false
          }
        });
      });
    });

    function event() {
      $('[data-button="edit"]').css('cursor', 'pointer').off('click').click(function () {
        var $this = $(this);

        $.ajax({
          type: 'get',
          url: "@url('#current')",
          data: 'id=' + $this.data('id')
        }).done(function (result) {
          if (result.total) {
            var info = result.rows[0];

            $('#id').val(info.id);
            $('#title').val(info.title);
            $('#description').val(info.description);

            $('#edit-dialog').modal();
          } else {
            new PNotify({
              title: "@lang('message.result', 'İşlem Sonucu')",
              text: "@lang('admin.message.item_not_found', 'Nesne bulunamadı!')",
              type: 'error',
              buttons: {
                closer: true,
                sticker: false
              },
              history: {
                history: false
              }
            });
          }
        });
      });

      $('[data-button="delete"]').css('cursor', 'pointer').off('click').click(function () {
        var $this = $(this);

        $.ajax({
          type: 'DELETE',
          url: "@url('#current/delete')/" + $this.data('id')
        }).done(function (result) {
          if (result.success) {
            $this.closest('.mix').remove();
          }

          new PNotify({
            title: "@lang('message.result', 'İşlem Sonucu')",
            text: result.text,
            type: result.success ? 'success' : 'error',
            buttons: {
              closer: true,
              sticker: false
            },
            history: {
              history: false
            }
          });
        });
      });
    }

    //To keep our code clean and modular, all custom functionality will be contained inside a single object literal called "dropdownFilter".
    var dropdownFilter = {
      // Declare any variables we will need as properties of the object
      $filters: null,
      $reset: null,
      groups: [],
      outputArray: [],
      outputString: '',

      // The "init" method will run on document ready and cache any jQuery objects we will need.
      init: function () {
        var self = this; // As a best practice, in each method we will asign "this" to the variable "self" so that it remains scope-agnostic. We will use it to refer to the parent "dropdownFilter" object so that we can share methods and properties between all parts of the object.

        self.$filters = $('#select-filters');
        self.$reset = $('#mix-reset');
        self.$container = $('#mix-container');

        self.$filters.find('fieldset').each(function () {
          self.groups.push({
            $dropdown: $(this).find('select'),
            active: ''
          });
        });

        self.bindHandlers();
      },

      // The "bindHandlers" method will listen for whenever a select is changed.
      bindHandlers: function () {
        var self = this;

        // Handle select change
        self.$filters.on('change', 'select', function (e) {
          e.preventDefault();

          self.parseFilters();
        });

        // Handle reset click
        self.$reset.on('click', function (e) {
          e.preventDefault();

          self.$filters.find('select').val('');

          self.parseFilters();
        });
      },

      // The parseFilters method pulls the value of each active select option
      parseFilters: function () {
        var self = this;

        // loop through each filter group and grap the value from each one.
        for (var i = 0, group; group = self.groups[i]; i++) {
          group.active = group.$dropdown.val();
        }

        self.concatenate();
      },

      // The "concatenate" method will crawl through each group, concatenating filters as desired:
      concatenate: function () {
        var self = this;

        self.outputString = ''; // Reset output string

        for (var i = 0, group; group = self.groups[i]; i++) {
          self.outputString += group.active;
        }

        // If the output string is empty, show all rather than none:
        !self.outputString.length && (self.outputString = 'all');

        //console.log(self.outputString);
        // ^ we can check the console here to take a look at the filter string that is produced

        // Send the output string to MixItUp via the 'filter' method:
        if (self.$container.mixItUp('isLoaded')) {
          self.$container.mixItUp('filter', self.outputString);
        }
      }
    };

    // To keep our code clean and modular, all custom functionality will be contained inside a single object literal called "checkboxFilter".
    var checkboxFilter = {
      // Declare any variables we will need as properties of the object
      $filters: null,
      $reset: null,
      groups: [],
      outputArray: [],
      outputString: '',

      // The "init" method will run on document ready and cache any jQuery objects we will need.
      init: function () {
        var self = this; // As a best practice, in each method we will assign "this" to the variable "self" so that it remains scope-agnostic. We will use it to refer to the parent "checkboxFilter" object so that we can share methods and properties between all parts of the object.

        self.$filters = $('#checkbox-filters');
        self.$reset = $('#mix-reset2');
        self.$container = $('#mix-container');

        self.$filters.find('fieldset').each(function () {
          self.groups.push({
            $inputs: $(this).find('input'),
            active: [],
            tracker: false
          });
        });

        self.bindHandlers();
      },

      // The "bindHandlers" method will listen for whenever a form value changes.
      bindHandlers: function () {
        var self = this;

        self.$filters.on('change', function () {
          self.parseFilters();
        });

        self.$reset.on('click', function (e) {
          e.preventDefault();
          self.$filters[0].reset();
          self.parseFilters();
        });
      },

      // The parseFilters method checks which filters are active in each group:
      parseFilters: function () {
        var self = this;

        // loop through each filter group and add active filters to arrays
        for (var i = 0, group; group = self.groups[i]; i++) {
          group.active = []; // reset arrays
          group.$inputs.each(function () {
            $(this).is(':checked') && group.active.push(this.value);
          });
          group.active.length && (group.tracker = 0);
        }

        self.concatenate();
      },

      // The "concatenate" method will crawl through each group, concatenating filters as desired:
      concatenate: function () {
        var self = this,
          cache = '',
          crawled = false,
          checkTrackers = function () {
            var done = 0;

            for (var i = 0, group; group = self.groups[i]; i++) {
              (group.tracker === false) && done++;
            }

            return (done < self.groups.length);
          },
          crawl = function () {
            for (var i = 0, group; group = self.groups[i]; i++) {
              group.active[group.tracker] && (cache += group.active[group.tracker]);

              if (i === self.groups.length - 1) {
                self.outputArray.push(cache);
                cache = '';
                updateTrackers();
              }
            }
          },
          updateTrackers = function () {
            for (var i = self.groups.length - 1; i > -1; i--) {
              var group = self.groups[i];

              if (group.active[group.tracker + 1]) {
                group.tracker++;
                break;
              } else if (i > 0) {
                group.tracker && (group.tracker = 0);
              } else {
                crawled = true;
              }
            }
          };

        self.outputArray = []; // reset output array

        do {
          crawl();
        }
        while (!crawled && checkTrackers());

        self.outputString = self.outputArray.join();

        // If the output string is empty, show all rather than none:
        !self.outputString.length && (self.outputString = 'all');

        //console.log(self.outputString);
        // ^ we can check the console here to take a look at the filter string that is produced

        // Send the output string to MixItUp via the 'filter' method:
        if (self.$container.mixItUp('isLoaded')) {
          self.$container.mixItUp('filter', self.outputString);
        }
      }
    };

    // Init multiselect plugin on filter dropdowns
    $('#filter1').multiselect({
      buttonClass: 'btn btn-default'
    });
    $('#filter2').multiselect({
      buttonClass: 'btn btn-default'
    });

    // Init checkboxFilter code
    checkboxFilter.init();

    // Init dropdownFilter code
    dropdownFilter.init();

    function mixer() {
      if (init) {
        $container.mixItUp('destroy');
      }

      // Instantiate MixItUp
      $container.mixItUp({
        controls: {
          enable: false // we won't be needing these
        },
        animation: {
          duration: 400,
          effects: 'fade translateZ(-360px) stagger(45ms)',
          easing: 'ease'
        },
        callbacks: {
          onMixFail: function () {
            init = false;
          },
          onMixEnd: function () {
            init = true;
          }
        }
      });

      $toList.on('click', function () {
        if ($container.hasClass('list')) {
          return;
        }
        $container.mixItUp('changeLayout', {
          display: 'block',
          containerClass: 'list'
        }, function (state) {
          // callback function
        });
      });
      $toGrid.on('click', function () {
        if ($container.hasClass('grid')) {
          return;
        }
        $container.mixItUp('changeLayout', {
          display: 'inline-block',
          containerClass: 'grid'
        }, function (state) {
          // callback function
        });
      });

      // Add Gallery Item to Lightbox
      $('.mix.image img').magnificPopup({
        type: 'image',
        callbacks: {
          beforeOpen: function (e) {
            // we add a class to body to indicate overlay is active
            // We can use this to alter any elements such as form popups
            // that need a higher z-index to properly display in overlays
            $('body').addClass('mfp-bg-open');

            // Set Magnific Animation
            this.st.mainClass = 'mfp-zoomIn';

            // Inform content container there is an animation
            this.contentContainer.addClass('mfp-with-anim');
          },
          afterClose: function (e) {
            $('body').removeClass('mfp-bg-open');
          },
          elementParse: function (item) {
            // Function will fire for each target element
            // "item.el" is a target DOM element (if present)
            // "item.src" is a source that you may modify
            var info = item.el.data('info');
            item.src = info.poster;
          }
        },
        removalDelay: 200 //delay removal by X to allow out-animation
      });

      $('.mix.link img').magnificPopup({
        type: 'iframe',
        disableOn: 700,
        preloader: false,
        fixedContentPos: false,
        callbacks: {
          beforeOpen: function (e) {
            // we add a class to body to indicate overlay is active
            // We can use this to alter any elements such as form popups
            // that need a higher z-index to properly display in overlays
            $('body').addClass('mfp-bg-open');

            // Set Magnific Animation
            this.st.mainClass = 'mfp-zoomIn';

            // Inform content container there is an animation
            this.contentContainer.addClass('mfp-with-anim');
          },
          afterClose: function (e) {
            $('body').removeClass('mfp-bg-open');
          },
          elementParse: function (item) {
            // Function will fire for each target element
            // "item.el" is a target DOM element (if present)
            // "item.src" is a source that you may modify
            var info = item.el.data('info');
            item.src = info.link;
          }
        },
        removalDelay: 200 //delay removal by X to allow out-animation
      });

      $('.mix.video img, .mix.audio img').magnificPopup({
        type: 'inline',
        preloader: false,
        closeBtnInside: false,
        callbacks: {
          beforeOpen: function (e) {
            // we add a class to body to indicate overlay is active
            // We can use this to alter any elements such as form popups
            // that need a higher z-index to properly display in overlays
            $('body').addClass('mfp-bg-open');

            // Set Magnific Animation
            this.st.mainClass = 'mfp-zoomIn';

            // Inform content container there is an animation
            this.contentContainer.addClass('mfp-with-anim');
          },
          afterClose: function (e) {
            $('body').removeClass('mfp-bg-open');
          },
          elementParse: function (item) {
            var ext;

            // Function will fire for each target element
            // "item.el" is a target DOM element (if present)
            // "item.src" is a source that you may modify
            var info = item.el.data('info');
            item.src = '#' + info.role + '-modal';

            if (info.role == 'audio') {
              var audio = $('<audio/>', {
                'controls': true,
                'autoplay': true
              }).appendTo($(item.src).empty());

              for (ext in info.sources) {
                $('<source/>', {
                  'src': info.sources[ext],
                  'type': 'audio/' + ext
                }).appendTo(audio);
              }
            } else if (info.role == 'video') {
              var video = $('<video/>', {
                'width': 640,
                'height': 480,
                'controls': true,
                'autoplay': true
              }).appendTo($(item.src).empty());

              for (ext in info.sources) {
                $('<source/>', {
                  'src': info.sources[ext],
                  'type': 'video/' + ext
                }).appendTo(video);
              }
            }
          }
        }
      });
    }

    $('#filter-form').submit(function (e) {
      e.preventDefault();

      loadList(true);
    });
  });
  //]]>
</script>
@stop